<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS黑夜之路</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="qq call me message">
<meta property="og:type" content="website">
<meta property="og:title" content="iOS黑夜之路">
<meta property="og:url" content="http://reqianduan.com//">
<meta property="og:site_name" content="iOS黑夜之路">
<meta property="og:description" content="qq call me message">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS黑夜之路">
<meta name="twitter:description" content="qq call me message">

  
    <link rel="alternative" href="/atom.xml" title="iOS黑夜之路" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">iOS黑夜之路</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">iOS黑夜之路官方博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://reqianduan.com/"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2014072520" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072520/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072520/">数组归类前提是已经排序好笑脸</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿这个方法可以将数组内元素相同的归位一类- (NSArray <em>)sort:(NSArray </em>)oldArr {</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="command">\tNSMutableArray</span> *newArr = <span class="special">[</span>NSMutableArray array<span class="special">]</span>;</div><div class="line"><span class="command">\tid</span> tmpObj;</div><div class="line"><span class="command">\ttmpObj</span> = oldArr.firstObject;</div><div class="line"><span class="command">\tNSMutableArray</span> *tmpArr = <span class="special">[</span>NSMutableArray array<span class="special">]</span>;</div><div class="line"><span class="command">\tfor</span> (int i = 0; i &lt; oldArr.count; i++) <span class="special">{</span></div><div class="line"><span class="command">\t</span><span class="command">\tif</span> (<span class="special">[</span>tmpObj isEqual:oldArr<span class="special">[</span>i<span class="special">]</span><span class="special">]</span>) <span class="special">{</span></div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="command">\t</span><span class="special">[</span>tmpArr addObject:oldArr<span class="special">[</span>i<span class="special">]</span><span class="special">]</span>;</div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="special">}</span></div><div class="line"><span class="command">\t</span><span class="command">\telse</span> <span class="special">{</span></div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="command">\t</span><span class="special">[</span>newArr addObject:tmpArr<span class="special">]</span>;</div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="command">\ttmpArr</span> = <span class="special">[</span>NSMutableArray array<span class="special">]</span>;</div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="command">\t</span><span class="special">[</span>tmpArr addObject:oldArr<span class="special">[</span>i<span class="special">]</span><span class="special">]</span>;</div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="command">\ttmpObj</span> = oldArr<span class="special">[</span>i<span class="special">]</span>;</div><div class="line"><span class="command">\t</span><span class="command">\t</span><span class="special">}</span></div><div class="line"><span class="command">\t</span><span class="special">}</span></div><div class="line"><span class="command">\t</span><span class="special">[</span>newArr addObject:tmpArr<span class="special">]</span>;</div><div class="line"><span class="command">\treturn</span> newArr;</div><div class="line"><span class="special">}</span></div></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSArray <span class="variable">*arr</span> = <span class="variable">@[</span><span class="variable">@1</span>,<span class="variable">@1</span>,<span class="variable">@2</span>,<span class="variable">@2</span>,<span class="variable">@3</span>,<span class="variable">@3</span>];</div><div class="line">NSArray <span class="variable">*arr12</span> = [self <span class="keyword">sort</span>:arr];</div><div class="line">NSLog(<span class="variable">@\</span><span class="string">"%@\",arr12);</span></div></pre></td></tr></table></figure>

<p>前提是顺序必须排好</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072520/" data-id="5eyd1it2whlfwuda" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072520/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014072511" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072511/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072511/">objectc之runtime四川兄原创</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿####object-c之runtime<br>最近看了些关于object-c（以下简称oc）的runtime文章，了解了些oc的原理，下面阐述下oc的一些机制</p>
<h4 id="引：">引：</h4>
<p>\toc是一门简单的语言，95%是C。只是在语言层面上加了些关键字和语法。真正让oc如此强大的是它的运行时。它很小但却很强大。它的核心是消息分发。<br>\t1、runtime是开源的。可以去down：<a href="http://opensource.apple.com/tarballs/objc4/objc4-437.1.tar.gz" target="_blank" rel="external">http://opensource.apple.com/tarballs/objc4/objc4-437.1.tar.gz</a><br>\t2、runtime是（基本上，还有部分是汇编，反正很多都是各种宏，in my opinion）由C语言实现的。<br>\t3、runtime的两个版本。（这个不知道要表达个什么，大概是些历史什么的）</p>
<h4 id="归纳了下，oc的核心思想是消息机制，先说在这。">归纳了下，oc的核心思想是消息机制，先说在这。</h4>
<p>讲下oc里类的原理。首先我们看他对类的定义:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object {</div><div class="line">    Class isa;</div><div class="line">} *<span class="keyword">id</span>;</div></pre></td></tr></table></figure>

<p>大多数面向对象的语言里有 classes 和 objects 的概念。Objects通过Classes生成。但是在Objective-C中，classes本身也是objects(译者注：这点跟python很像)，也可以处理消息，这也是为什么会有类方法和实例方法。具体来说，Objective-C中的Object是一个结构体(struct)，第一个成员是isa，指向自己的class。这是在objc/objc.h中定义的。</p>
<p>object的class保存了方法列表，还有指向父类的指针。但classes也是objects，也会有isa变量，那么它又指向哪儿呢？这里就引出了第三个类型: metaclasses。一个 metaclass被指向class，class被指向object。它保存了所有实现的方法列表，以及父类的metaclass<br>这个的定义在runtime.h里：<br>这里引入一段精辟的看不大清楚的话（Objective-C is a class-based object system. Each object is an instance of some class; the object\’s isa pointer points to its class. That class describes the object\’s data: allocation size and ivar types and layout. The class also describes the object\’s behavior: the selectors it responds to and instance methods it implements.）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_class {</div><div class="line">    Class isa  OBJC_ISA_AVAILABILITY;</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> !__OBJC2__</span></div><div class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">struct</span> objc_cache *cache                                 OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"></div><div class="line">} OBJC2_UNAVAILABLE;</div></pre></td></tr></table></figure>

<p>从中可以清楚的看到一个Class到底里面是些什么东西，父类，名字，还有一堆我们关心的方法，协议，缓存数据等（还有几个，我不好意思说）。<br>可以看到方法协议，什么的都用的还是struct。</p>
<p>下面我捡一些好听的来说。<br>当然我们肯定关心的是方法，首先看下方法列表的定义：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_method_list {</div><div class="line">    <span class="keyword">struct</span> objc_method_list *obsolete                        OBJC2_UNAVAILABLE;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">int</span> method_count                                         OBJC2_UNAVAILABLE;</div><div class="line"><span class="preprocessor">#ifdef __LP64__</span></div><div class="line">    <span class="keyword">int</span> space                                                OBJC2_UNAVAILABLE;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="comment">/* variable length structure */</span></div><div class="line">    <span class="keyword">struct</span> objc_method method_list[<span class="number">1</span>]                        OBJC2_UNAVAILABLE;</div><div class="line">}                                                            OBJC2_UNAVAILABLE;</div></pre></td></tr></table></figure>

<p>大概是什么捏，我也看不大明白，没事继续看下方法的具体定义：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> </span>{</div><div class="line">    SEL method_name                                          OBJC2_UNAVAILABLE;</div><div class="line">    char *method_types                                       OBJC2_UNAVAILABLE;</div><div class="line">    IMP method_imp                                           OBJC2_UNAVAILABLE;</div><div class="line">}                                                            OBJC2_UNAVAILABLE;</div></pre></td></tr></table></figure>

<p>这下差不多了，这是具体方法的定义。这个内部的剖析，等下在说，先绕开往下说下objc_cache。<br>看看objc_cache的定义：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_cache {</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> mask <span class="comment">/* total = mask + 1 */</span>                 OBJC2_UNAVAILABLE;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> occupied                                    OBJC2_UNAVAILABLE;</div><div class="line">    Method buckets[<span class="number">1</span>]                                        OBJC2_UNAVAILABLE;</div><div class="line">} <span class="comment">/* GrP fixme should be OBJC2_UNAVAILABLE, but isn\'t because of spurious warnings in [super ...] calls */</span>;</div></pre></td></tr></table></figure>

<p>等下，这有个Method有点蕾丝objc_method哈，于是找到这个定义：<br>typedef struct objc_method *Method;<br>联系上鸟。</p>
<p>好吧，不绕了，讲讲方法吧，这里也就是上面要涉及但憋回去的消息机制。<br>说起方法就不得不说他的机制，oc里的方法就是消息，Look：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSMutableArray *arr = [NSMutableArray arrayWithObject<span class="variable">s:</span>@\<span class="string">"dd\", nil];</span></div><div class="line">[arr addObjec<span class="variable">t:</span>@\<span class="string">"k\"];</span></div><div class="line">objc_msgSend(arr, @selector(addObjec<span class="variable">t:</span>),@\<span class="string">"pp\");</span></div><div class="line">NSLog(@\<span class="string">"arr:%@\"</span>,arr);</div></pre></td></tr></table></figure>

<p>他们可以等价，调用array的insertObject的方法，参数分别是foo,5。上面就是典型的oc试，下面就是等价的消息模式，亲侧可行，前提是你得引入消息模式的文件。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#if TARGET_IPHONE_SIMULATOR</span></div><div class="line"><span class="preprocessor">#import &lt;objc/objc-runtime.h&gt;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">#import &lt;objc/runtime.h&gt;</span></div><div class="line"><span class="preprocessor">#import &lt;objc/message.h&gt;</span></div><div class="line"><span class="preprocessor">#endif</span></div></pre></td></tr></table></figure>

<p>这就是引入。</p>
<p>跑了有点裤子穿偏了，回过神来继续说这个objc_method,逐个说下<br>SEL 类成员方法的指针：<br>可以理解 @selector()就是取类方法的编号,他的行为基本可以等同C语言的中函数指针,只不过C语言中，可以把函数名直接赋给一个函数指针，而Object-C的类不能直接应用函数指针，这样只能做一个@selector语法来取.<br>可以用这个NSSelectorFromString直接取,NSStringFromSelector反转。</p>
<p>简单说就是函数的地址，只不过函数的地址和函数实现的地址不在同一个地方。</p>
<p>method_types 描述方法的参数列表. 在运行时注册选择器时使用.那时候方法名就会包含方法的参数列表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method_imp 之 <span class="type">IMP</span> 是”implementation”的缩写，它是objetive-C 方法(<span class="keyword">method</span>)实现代码块的地址，可像C函数一样直接调用。通常情况下我们是通过[<span class="keyword">object</span> <span class="keyword">method</span>:parameter]或objc_msgSend()的方式向对象发送消息，然后<span class="type">Objective</span>-C运行时(<span class="type">Objective</span>-C runtime)寻找匹配此消息的<span class="type">IMP</span>,然后调用它;但有些时候我</div></pre></td></tr></table></figure>

<p>们希望获取到IMP进行直接调用。</p>
<p>简单来说method_imp就是函数实现的代码块地址。</p>
<p>方法大概就这些，接下来就说下，对象是怎么找到方法的，这里涉及到一些原理，我们可以假装不知道的。<br>当一个对象去执行某一个方法的时候，首先去是cache里找method，因为这个最快（他们都是存到hash里的），当找不到的时候才去那个objc_method_list里找，如果还没有就去super_class里找，这样循环到根上也就是NSObject，还是没有就不好意思crash了。</p>
<p>接下来说下平常coding有用的东西了</p>
<p>class开头的方法是用来修改和自省classes。方法如class_addIvar, class_addMethod, class_addProperty和class_addProtocol允许重建classes。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class_copyIvarList, class_copyMethodList, class_copyProtocolList和class_copyPropertyList能拿到一个<span class="class"><span class="keyword">class</span>的所有内容。而<span class="title">class_getClassMethod</span>, <span class="title">class_getClassVariable</span>, <span class="title">class_getInstanceMethod</span>, <span class="title">class_getInstanceVariable</span>, <span class="title">class_getMethodImplementation</span>和<span class="title">class_getProperty</span>返回单个内容。</span></div></pre></td></tr></table></figure>

<p>假设我要取回去某个对象的属性或者方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">uint attrCount = <span class="number">0</span>,selfCount = <span class="number">0</span>;</div><div class="line">objc_property_t *attrs = class_copyPropertyList([<span class="keyword">self</span> <span class="keyword">class</span>], &attrCount);</div><div class="line"><span class="function"><span class="keyword">Method</span> *<span class="title">method</span> =  <span class="title">class_copyMethodList</span><span class="params">([<span class="keyword">self</span> <span class="keyword">class</span>], &selfCount)</span>;</span></div><div class="line"><span class="keyword">for</span> (int i=<span class="number">0</span>;i&lt;=count;++i) <span class="comment">{</span></div><div class="line">        objc_property_t property = attrs[i];</div><div class="line">        NSLog(@\"key:%s,value:%@\",property_getName(property),[self valueForKey:[NSString stringWithFormat:@\"%s\",property_getName(property)]]);</div><div class="line">}</div><div class="line"><span class="keyword">for</span> (int i=<span class="number">0</span>;i&lt;=count1;++i) <span class="comment">{</span></div><div class="line">    SEL sel = method_getName(method[i]);</div><div class="line">    IMP imp = method_getImplementation(method[i]);</div><div class="line">    NSLog(@\"sel:%s\",sel_getName(sel));</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这些都不算啥，现在说点动态的东西，比如动态添加属性，动态添加方法。</p>
<p>这里其实我们需要用class_addMethod就可以了。</p>
<p>这里有必要说下</p>
<figure class="highlight +(BOOL)resolveInstanceMethod:(SEL)sel;"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">和</div><div class="line"><span class="addition">+(BOOL)resolveClassMethod:(SEL)sel;</span></div></pre></td></tr></table></figure>

<p>字面上来说，一个是对象方法，一个是类方法，都是消息转发机制前调用的。</p>
<p>意思是如果我们劫持重写这个，就可以添加一切我们想要的方法。<br>下面拿一个世界上最干净的类之一来说事：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DB</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DB</span></span></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

<p>如果我现在</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="pseudo">DB</span> *d = [<span class="pseudo">DB</span> new]<span class="comment">;</span></div><div class="line">[d alert]<span class="comment">;</span></div></pre></td></tr></table></figure>

<p>有人要说我傻x了，好吧，我牺牲自己引入下文：</p>
<p>对，我们上面说到了劫持，所以我就继承了这个方法，并重写了下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">ex：</div><div class="line">//这个就是alert函数实现的地方。</div><div class="line"><span class="method">ps:</span>这里得多说几句，第一个参数是消息的发起方，就对象，<span class="keyword">self</span>就是方法的指针。必须的，后面的参数就跟着依次。</div><div class="line">void defineIMPForAlert(id <span class="keyword">self</span>,<span class="class">SEL</span> _cmd){</div><div class="line">    <span class="class">NSLog</span>(@\<span class="comment">"xxxx\"</span>);</div><div class="line">}</div><div class="line"><span class="method">ps:</span>这里可以通过重写这个，当然也可以在外面直接用class_addMethod.</div><div class="line">+(<span class="class">BOOL</span>)<span class="method">resolveInstanceMethod:</span>(<span class="class">SEL</span>)sel{</div><div class="line">//当在调用alert的时候，会自动添加这个方法进去。</div><div class="line">    if(sel == @selector(alert)){</div><div class="line">    //这里就劫持了并添加并实现了我想要的方法。最后那个参数是个奇葩见(<span class="number">1</span>)说明。</div><div class="line"></div><div class="line"></div><div class="line">        class_addMethod([<span class="keyword">self</span> class],sel,(<span class="class">IMP</span>)defineIMPForAlert,[@\<span class="comment">"v@:\"</span> <span class="class">UTF8String</span>]);</div><div class="line">        return <span class="class">YES</span>;</div><div class="line">    }</div><div class="line">    return [<span class="keyword">super</span> <span class="method">resolveClassMethod:</span>sel];</div><div class="line">}</div></pre></td></tr></table></figure>

<p>哈。我的对象就具备了alert的方法。也就是说我的对象就可以来发送alert的消息。好吧，就是说我[d performSelector:@selector(alert)];就合法了(注意这里不能直接写[d alert]，因为我那个是动态添加的应该是说要在运行的时候才有alert方法，所以ide并不知道，编译也不会让你过)。尽管我什么alert都没定义。</p>
<p>记得上面说过属性也可以，是的，属性也可以。但网上的栗子都没成熟，所以，我就先放一个我测试过了的（看起来有点不舒服的栗子）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class">NSString</span>* name(id <span class="keyword">self</span>,<span class="class">SEL</span> _cmd){</div><div class="line">    return objc_getAssociatedObject(<span class="keyword">self</span>, @\<span class="comment">"name\"</span>);</div><div class="line">}</div><div class="line">void setName(id <span class="keyword">self</span>,<span class="class">SEL</span> _cmd,<span class="class">NSString</span> *name){</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, @\<span class="comment">"name\"</span>, name, <span class="class">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>);</div><div class="line">}</div><div class="line">class_addMethod([<span class="class">DB</span> class],@selector(name),(<span class="class">IMP</span>)name,[@\<span class="comment">"@@:\"</span> <span class="class">UTF8String</span>]);</div><div class="line">class_addMethod([<span class="class">DB</span> class],@selector(<span class="method">setName:</span>),(<span class="class">IMP</span>)setName,[@\<span class="comment">"v@:@\"</span> <span class="class">UTF8String</span>]);</div></pre></td></tr></table></figure>

<p>这样我就可以</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr_selector">[d performSelector:@selector(setName:) withObject:@\"ddd\"]</span>;</div><div class="line"><span class="tag">NSLog</span>(<span class="at_rule">@<span class="keyword">\"self.name:%@\",[d</span> performSelector:@<span class="function">selector</span>(name)])</span>;</div></pre></td></tr></table></figure>

<p>下面是些扩展用法。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="at_rule">@<span class="keyword">interface</span> CC : NSObject</span></div><div class="line"><span class="function">-</span>(void)say;</div><div class="line"><span class="tag">-</span>(<span class="tag">void</span>)<span class="tag">sing</span>;</div><div class="line"><span class="at_rule">@<span class="keyword">end</span></span></div><div class="line"></div><div class="line"></div><div class="line">@implementation CC</div><div class="line"><span class="function">-</span>(void)say{</div><div class="line">    <span class="tag">NSLog</span>(<span class="at_rule">@<span class="keyword">\"os\");</span></span></div><div class="line">}</div><div class="line"><span class="function">-</span>(void)sing{</div><div class="line">    <span class="tag">NSLog</span>(<span class="at_rule">@<span class="keyword">\"sn\");</span></span></div><div class="line">}</div><div class="line">@end</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">BB *b = [BB <span class="keyword">new</span>];</div><div class="line"><span class="comment">//我让b去继承cc的</span></div><div class="line">object_setClass(b, [CC <span class="keyword">class</span>]); <span class="comment">//实现方法。见(2)</span></div><div class="line"><span class="comment">//于是b就有了say的方法</span></div><div class="line">[b performSelector:@<span class="keyword">selector</span>(say)];</div><div class="line">CC *c = [CC <span class="keyword">new</span>];</div><div class="line"><span class="comment">//获取say的方法</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">methodSay</span> = <span class="title">class_getInstanceMethod</span><span class="params">([c <span class="keyword">class</span>], @<span class="keyword">selector</span>(say)</span>);</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">methodSing</span> = <span class="title">class_getInstanceMethod</span><span class="params">([c <span class="keyword">class</span>], @<span class="keyword">selector</span>(sing)</span>);</span></div><div class="line"><span class="comment">//交换2个方法</span></div><div class="line">method_exchangeImplementations(methodSay, methodSing); <span class="comment">//实现方法。见(3)</span></div><div class="line"><span class="comment">//于是有了结果的变化</span></div><div class="line">[c say];</div><div class="line">[c sing];</div><div class="line"><span class="comment">//b也跟着变了</span></div><div class="line">[b performSelector:@<span class="keyword">selector</span>(say)];</div></pre></td></tr></table></figure>

<p>以上。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">(<span class="number">1</span>)</div><div class="line">c <span class="type">char</span></div><div class="line">i  <span class="type">int</span></div><div class="line">s short</div><div class="line">l long</div><div class="line">l <span class="keyword">is</span> treated <span class="keyword">as</span> a <span class="number">32</span>-bit quantity on <span class="number">64</span>-bit programs.</div><div class="line">q long long</div><div class="line">C unsigned <span class="type">char</span></div><div class="line">I unsigned <span class="type">int</span></div><div class="line">S unsigned short</div><div class="line">L unsigned long</div><div class="line">Q unsigned long long</div><div class="line">f <span class="type">float</span></div><div class="line">d double</div><div class="line">B C++ <span class="type">bool</span> <span class="keyword">or</span> a <span class="type">C99</span> _Bool</div><div class="line">v <span class="type">void</span></div><div class="line">* character <span class="type">string</span> (<span class="type">char</span> *)</div><div class="line">@ <span class="keyword">object</span> (whether statically typed <span class="keyword">or</span> typed id)</div><div class="line"><span class="comment"># class object (Class)</span></div><div class="line">: <span class="keyword">method</span> selector (<span class="type">SEL</span>)</div><div class="line">[<span class="type">array</span> <span class="keyword">type</span>] <span class="type">array</span></div><div class="line">{name=<span class="keyword">type</span>...} structure</div><div class="line">(name=<span class="keyword">type</span>...) A union</div><div class="line">bnum bit field <span class="keyword">of</span> num bits</div><div class="line">^<span class="keyword">type</span> <span class="type">pointer</span> to <span class="keyword">type</span></div><div class="line">? <span class="type">An</span> unknown <span class="keyword">type</span> (among other things, this code <span class="keyword">is</span> used <span class="keyword">for</span> function pointers)</div><div class="line"><span class="type">PS</span>:貌似@：组成了返回类型和形参的分割线。</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Class</span> object_setClass(id obj, <span class="keyword">Class</span> cls)</div><div class="line">{</div><div class="line">    <span class="keyword">if</span> (obj) {</div><div class="line">        <span class="keyword">Class</span> old;</div><div class="line">        <span class="keyword">do</span> {</div><div class="line">            old = obj-&gt;isa;</div><div class="line">        } <span class="keyword">while</span> (! OSAtomicCompareAndSwapPtrBarrier(old, cls, (<span class="keyword">void</span>*)&obj-&gt;isa));</div><div class="line">        <span class="keyword">return</span> old;</div><div class="line">    }</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> Nil;</div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">void method_exchangeImplementations(Method m1_gen, Method m2_gen)</div><div class="line">{</div><div class="line">    IMP m1_imp;</div><div class="line">    <span class="keyword">struct</span> old_method *m1 = <span class="number">_</span>method_asOld(m1_gen);</div><div class="line">    <span class="keyword">struct</span> old_method *m2 = <span class="number">_</span>method_asOld(m2_gen);</div><div class="line">    <span class="keyword">if</span> (!m1  ||  !m2) <span class="keyword">return</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (m1-&gt;method_name == (SEL)kIgnore  ||  m2-&gt;method_name == (SEL)kIgnore) {</div><div class="line">        <span class="comment">// Ignored methods stay ignored. Now they\'re both ignored.</span></div><div class="line">        m1-&gt;method_imp = (IMP)&<span class="number">_</span>objc_ignored_method;</div><div class="line">        m2-&gt;method_imp = (IMP)&<span class="number">_</span>objc_ignored_method;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    OSSpinLockLock(&impLock);</div><div class="line">    m1_imp = m1-&gt;method_imp;</div><div class="line">    m1-&gt;method_imp = m2-&gt;method_imp;</div><div class="line">    m2-&gt;method_imp = m1_imp;</div><div class="line">    OSSpinLockUnlock(&impLock);</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072511/" data-id="7hr6l0xiiymdya8c" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072511/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-201407259" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/201407259/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/201407259/">ios手势密码四川兄原创</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> <span class="symbol">#import</span> &lt;<span class="class">UIKit</span>/<span class="class">UIKit</span>.h&gt; <span class="symbol">#import</span> &lt;<span class="class">QuartzCore</span>/<span class="class">QuartzCore</span>.h&gt; @interface <span class="class">GesturePassword</span> : <span class="class">UIView</span> @property(nonatomic,strong)<span class="class">NSMutableArray</span> *recordMovePoints; @property(nonatomic,assign)void(^generatePassword)(<span class="class">GesturePassword</span> *, <span class="class">NSString</span> *); @property(nonatomic,strong)<span class="class">UIWindow</span> *currentWindow; @property(nonatomic,strong)<span class="class">NSString</span> *rightPwd; -(void)registNotifyHandle; -(void)hideSelf; -(void)showSelf; -(<span class="class">GesturePassword</span> *)initByFrame; @end </div><div class="line"><span class="symbol">#import</span> \<span class="comment">"GesturePassword.h\"</span> //记录触碰点 static <span class="class">NSMutableArray</span> *recordCricleViews = <span class="keyword">nil</span>; //是否允许绘图，因为起点必须先点击到圆圈上 static <span class="class">BOOL</span> canDraw = <span class="class">NO</span>; //基础tag，用来记录圆圈的tag，这个也用来组成密码 const static int <span class="class">PointBaseTag</span> = <span class="number">1</span>; //线宽 const static int <span class="class">LineWidth</span> = <span class="number">6</span>; <span class="symbol">#define</span> <span class="class">BetweenWithNumber</span>(<span class="class">V</span>,<span class="class">A</span>,<span class="class">B</span>) [[<span class="class">NSPredicate</span> <span class="method">predicateWithFormat:</span>@\<span class="comment">"self between {%f,%f}\"</span>,[(<span class="class">A</span>) floatValue],[(<span class="class">B</span>) floatValue]] <span class="method">evaluateWithObject:</span>(<span class="class">V</span>)] @implementation <span class="class">GesturePassword</span> @synthesize recordMovePoints,generatePassword,currentWindow,rightPwd; //注册通知， -(void)registNotifyHandle{ //    后台来的时候执行锁屏操作     [[<span class="class">NSNotificationCenter</span> defaultCenter] <span class="method">addObserver:</span><span class="keyword">self</span> <span class="method">selector:</span>@selector(showLockScreen) <span class="method">name:</span><span class="class">UIApplicationWillEnterForegroundNotification</span> <span class="method">object:</span><span class="keyword">nil</span>]; } -(void)showLockScreen{     static <span class="class">BOOL</span> hadAddSubview = <span class="class">NO</span>; //    如果是挂上了，就直封屏     if(hadAddSubview){         [<span class="keyword">self</span> showSelf];         return;     } //    挂在window上。     <span class="class">UIWindow</span> *statusWindow = [[[<span class="class">UIApplication</span> sharedApplication] delegate] window];     statusWindow.windowLevel = <span class="class">UIWindowLevelStatusBar</span>;     [statusWindow <span class="method">addSubview:</span><span class="keyword">self</span>];     hadAddSubview = <span class="class">YES</span>; }  //初始化。 -(<span class="class">GesturePassword</span> *)initByFrame{     if((<span class="keyword">self</span> = [<span class="keyword">self</span> <span class="method">initWithFrame:</span>[[<span class="class">UIScreen</span> mainScreen] bounds]])){     }     return <span class="keyword">self</span>; } //初始化frame。 - (id)<span class="method">initWithFrame:</span>(<span class="class">CGRect</span>)frame {     <span class="keyword">self</span> = [<span class="keyword">super</span> <span class="method">initWithFrame:</span>frame];     recordMovePoints = [<span class="class">NSMutableArray</span> array];     if (<span class="keyword">self</span>) {         recordCricleViews = [<span class="class">NSMutableArray</span> array];         <span class="class">UIPanGestureRecognizer</span> *panGesture = [[<span class="class">UIPanGestureRecognizer</span> alloc] <span class="method">initWithTarget:</span><span class="keyword">self</span> <span class="method">action:</span>@selector(<span class="method">gestPanGesture:</span>)];         panGesture.minimumNumberOfTouches = panGesture.maximumNumberOfTouches = <span class="number">1</span>;         [<span class="keyword">self</span> <span class="method">addGestureRecognizer:</span>panGesture];         int i = <span class="number">0</span>,row=-<span class="number">1</span>;         float w = <span class="keyword">self</span>.frame.size.width, h = <span class="keyword">self</span>.frame.size.height, radius = <span class="number">20</span> , diameter = radius * <span class="number">2</span>;         //            算出每个物体之间的左右间距、         float spearX  = (w - (diameter * <span class="number">3</span>)) / <span class="number">4</span>,spearY = (h - (diameter * <span class="number">3</span>)) / <span class="number">4</span>;         while (i&lt;<span class="number">9</span>) {             int step = i%<span class="number">3</span>;             if(step==<span class="number">0</span>)++row;             float tempX = (step + <span class="number">1</span>) * spearX + step * diameter,tempY = (row+<span class="number">1</span>) * spearY + row * diameter;             @autoreleasepool {                 <span class="class">CGRect</span> tempRect = <span class="class">CGRectMake</span>(tempX, tempY, diameter, diameter);                 <span class="class">UIView</span> *cricleView = [[<span class="class">UIView</span> alloc] <span class="method">initWithFrame:</span>tempRect];                 cricleView.tag = <span class="class">PointBaseTag</span> + i ;                 cricleView.layer.cornerRadius = radius;                 cricleView.backgroundColor = [<span class="class">UIColor</span> grayColor];                 [<span class="keyword">self</span> <span class="method">addSubview:</span>cricleView];                 [recordCricleViews <span class="method">addObject:</span>cricleView];             }             ++i;         }     }     return <span class="keyword">self</span>; } //是否和几个目标物发生碰撞 -(<span class="class">UIView</span> *)<span class="method">hasTouchCricleView:</span>(<span class="class">CGPoint</span>)point{     __block <span class="class">UIView</span> *resultView = <span class="keyword">nil</span>;     [recordCricleViews  <span class="method">enumerateObjectsUsingBlock:</span>^(<span class="class">UIView</span> *sview,<span class="class">NSUInteger</span> index,<span class="class">BOOL</span> *stop){         if([<span class="keyword">self</span> <span class="method">rectsTouched:</span>point <span class="method">eimRect:</span>sview.frame]){             resultView = sview;             *stop = <span class="class">YES</span>;         }     }];     return resultView; } //检测当前点击坐标和物体是否碰撞 -(<span class="class">BOOL</span>)<span class="method">rectsTouched:</span>(<span class="class">CGPoint</span> )pointA <span class="method">eimRect:</span>(<span class="class">CGRect</span>)rectB{     <span class="class">BOOL</span> inX = <span class="class">BetweenWithNumber</span>(@(pointA.x),@(rectB.origin.x),@(rectB.origin.x + rectB.size.width)),                 inY = <span class="class">BetweenWithNumber</span>(@(pointA.y),@(rectB.origin.y),@(rectB.origin.y + rectB.size.height));     return inX && inY; } //拖动手势 -(void)<span class="method">gestPanGesture:</span>(<span class="class">UIPanGestureRecognizer</span> *)pan{ //    松开     if(pan.state == <span class="class">UIGestureRecognizerStateEnded</span>){         [recordCricleViews <span class="method">enumerateObjectsUsingBlock:</span>^(<span class="class">UIView</span> *tview,<span class="class">NSUInteger</span> index,<span class="class">BOOL</span> *stop){             [tview <span class="method">setBackgroundColor:</span>[<span class="class">UIColor</span> grayColor]];         }];         <span class="class">NSMutableString</span> *string = [<span class="class">NSMutableString</span> string];         [recordMovePoints <span class="method">enumerateObjectsUsingBlock:</span>^(<span class="class">NSArray</span> *array,<span class="class">NSUInteger</span> index,<span class="class">BOOL</span> *stop){ //            过滤掉<span class="number">0</span>             if([array[<span class="number">0</span>] intValue]&gt;<span class="number">0</span>)             [string <span class="method">appendFormat:</span>@\<span class="comment">"%d\"</span>,[array[<span class="number">0</span>] intValue]];         }];         recordMovePoints = <span class="keyword">nil</span>;         canDraw = <span class="class">NO</span>;         [<span class="keyword">self</span> setNeedsDisplay];         if(generatePassword){             generatePassword(<span class="keyword">self</span>,string);         }         return;     } //    按下     else if(pan.state == <span class="class">UIGestureRecognizerStateBegan</span>){         <span class="class">CGPoint</span> touchPoint  = [pan <span class="method">locationInView:</span>pan.view];         <span class="class">UIView</span> *tempTouchedView = [<span class="keyword">self</span> <span class="method">hasTouchCricleView:</span>touchPoint];         if(tempTouchedView){             recordMovePoints = [<span class="class">NSMutableArray</span> <span class="method">arrayWithObject:</span>@[@(tempTouchedView.tag),[<span class="class">NSValue</span> <span class="method">valueWithCGPoint:</span>tempTouchedView.center]]];             tempTouchedView.backgroundColor = [<span class="class">UIColor</span> greenColor];             canDraw = <span class="class">YES</span>;         }else{             canDraw = <span class="class">NO</span>;         }     } //    move。     else if(pan.state == <span class="class">UIGestureRecognizerStateChanged</span>){         if(!canDraw)return; //    判断拖动边界。         <span class="class">CGPoint</span> touchPoint  = [pan <span class="method">locationInView:</span>pan.view];         float dx = touchPoint.x,         dy = touchPoint.y; //        越界不能。         if(!<span class="class">BetweenWithNumber</span>(@(dx),@<span class="number">0</span>,@(<span class="keyword">self</span>.frame.size.width)) || !<span class="class">BetweenWithNumber</span>(@(dy),@<span class="number">0</span>,@(<span class="keyword">self</span>.frame.size.height)))return;         <span class="class">UIView</span> *tempTouchedView = [<span class="keyword">self</span> <span class="method">hasTouchCricleView:</span>touchPoint]; //        不能重复。                  if(tempTouchedView){             if([[recordMovePoints <span class="method">filteredArrayUsingPredicate:</span>[<span class="class">NSPredicate</span> <span class="method">predicateWithFormat:</span>@\<span class="comment">"self[0] ==%d\"</span>,tempTouchedView.tag]] count]==<span class="number">0</span>){                 if([[recordMovePoints lastObject][<span class="number">0</span>] intValue]==<span class="number">0</span>)[recordMovePoints <span class="method">removeObject:</span>[recordMovePoints lastObject]]; //                <span class="class">NSLog</span>(@\<span class="comment">"recordMovePoints:%@\"</span>,recordMovePoints);                 tempTouchedView.backgroundColor = [<span class="class">UIColor</span> greenColor];                 [recordMovePoints <span class="method">addObject:</span>@[@(tempTouchedView.tag),[<span class="class">NSValue</span> <span class="method">valueWithCGPoint:</span>tempTouchedView.center]]];                 [<span class="keyword">self</span> setNeedsDisplay];             }         }else{             if([[recordMovePoints lastObject][<span class="number">0</span>] intValue]==<span class="number">0</span>)[recordMovePoints <span class="method">removeObject:</span>[recordMovePoints lastObject]];             [recordMovePoints <span class="method">addObject:</span>@[@<span class="number">0</span>,[<span class="class">NSValue</span> <span class="method">valueWithCGPoint:</span>touchPoint]]];             [<span class="keyword">self</span> setNeedsDisplay];         }     } } -(void)hideSelf{     <span class="class">CGRect</span> rect = <span class="keyword">self</span>.frame;     rect.origin.y = [[<span class="class">UIScreen</span> mainScreen] applicationFrame].size.height + <span class="number">20</span>;     [<span class="class">UIView</span> <span class="method">animateWithDuration:</span><span class="number">1</span> <span class="method">animations:</span>^{         [<span class="keyword">self</span> <span class="method">setFrame:</span>rect];     }]; } -(void)showSelf{     <span class="class">CGRect</span> rect = <span class="keyword">self</span>.frame;     rect.origin.y = <span class="number">0</span>;     [<span class="keyword">self</span> <span class="method">setFrame:</span>rect]; } //画图 -(void)<span class="method">drawRect:</span>(<span class="class">CGRect</span>)rect{     <span class="class">CGContextRef</span> context = <span class="class">UIGraphicsGetCurrentContext</span>();     <span class="class">UIGraphicsBeginImageContextWithOptions</span>(<span class="keyword">self</span>.frame.size, <span class="class">YES</span>, <span class="number">1</span>); //    如果没有记录拖拽的点，就清空     if(recordMovePoints==<span class="keyword">nil</span> || recordMovePoints.count&lt;=<span class="number">1</span>){         <span class="class">CGContextSetFillColorWithColor</span>(context, <span class="keyword">self</span>.backgroundColor.<span class="class">CGColor</span>);         return <span class="class">CGContextFillPath</span>(context);     } //    设置圆滑拐角     <span class="class">CGContextSetLineJoin</span>(context, kCGLineJoinRound);     <span class="class">CGPoint</span> beginPoint = [recordMovePoints[<span class="number">0</span>][<span class="number">1</span>] <span class="class">CGPointValue</span>];     <span class="class">CGContextMoveToPoint</span>(context, beginPoint.x, beginPoint.y);     <span class="class">CGContextSetLineWidth</span>(context, <span class="class">LineWidth</span>);     <span class="class">CGContextSetStrokeColorWithColor</span>(context, [<span class="class">UIColor</span> yellowColor].<span class="class">CGColor</span>); //    开始画，根据点。     [recordMovePoints <span class="method">enumerateObjectsUsingBlock:</span>^(<span class="class">NSArray</span> *array,<span class="class">NSUInteger</span> index,<span class="class">BOOL</span> *stop){         <span class="class">CGPoint</span> tempPoint = [array[<span class="number">1</span>]  <span class="class">CGPointValue</span>];         <span class="class">CGContextAddLineToPoint</span>(context, tempPoint.x, tempPoint.y);     }];     <span class="class">CGContextStrokePath</span>(context); } @end 调用： <span class="class">GesturePassword</span> *pwdBoard = [[<span class="class">GesturePassword</span> alloc] initByFrame];     pwdBoard.backgroundColor = [<span class="class">UIColor</span> brownColor]; //    注册通知。     [pwdBoard registNotifyHandle];     pwdBoard.generatePassword = ^(<span class="class">GesturePassword</span> *passboard,<span class="class">NSString</span> *pwdString){         if([pwdString <span class="method">isEqualToString:</span>@\<span class="comment">"123456\"</span>]){             [passboard hideSelf];         }     };</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/201407259/" data-id="8shgkc0au4ujdrxf" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/201407259/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-201407256" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/201407256/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: “ios黑夜之路技术群成就榜”tag: [ios]categories: ios—-\n\t命运像一丝细线，穿梭于茫茫人海，将你我窜成一线，相识在这里。\t时光流逝，大浪淘沙，勇于拼搏创新者，你们历尽艰辛，为了鼓励后人已此贴铭记、敬仰你们。</p>
<h4 id="一、《猫狗大作战》">一、《猫狗大作战》</h4>
<p>2014年5月6号，当哥同学已优秀的《猫狗大作战》萌系游戏荣获腾讯发文宣传</p>
<p>文章地址:<a href="http://games.qq.com/a/20140506/050166.htm" target="_blank" rel="external">http://games.qq.com/a/20140506/050166.htm</a><br>优秀作品下载地址:<a href="http://app.lenovo.com/app/14497517.html" target="_blank" rel="external">http://app.lenovo.com/app/14497517.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/201407256/" data-id="tztf2e34vqon5q1e" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/201407256/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-201407253" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/201407253/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/201407253/">instancesRespondToSelector与respondsToSelector注意点Only转载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">﻿/<span class="regexp">/ main.m#import &lt;Foundation/</span><span class="constant">Foundation</span>.h&gt;<span class="variable">@interface</span> <span class="constant">Test</span> <span class="symbol">:</span> <span class="constant">NSObject</span>-(void) objectFun;+(void) classFun;<span class="variable">@end</span><span class="variable">@implementation</span> <span class="constant">Test</span>-(void) objectFun{}+(void) classFun{}<span class="variable">@endint</span> main(){<span class="constant">BOOL</span> ret;ret=[<span class="constant">Test</span> <span class="symbol">instancesRespondToSelector:</span><span class="variable">@selector</span>(objectFun)];    <span class="regexp">//</span><span class="constant">YESret</span>=[<span class="constant">Test</span> <span class="symbol">instancesRespondToSelector:</span><span class="variable">@selector</span>(classFun)];    <span class="regexp">//</span><span class="constant">NOret</span>=[<span class="constant">Test</span> <span class="symbol">respondsToSelector:</span><span class="variable">@selector</span>(objectFun)];    <span class="regexp">//</span><span class="constant">NOret</span>=[<span class="constant">Test</span> <span class="symbol">respondsToSelector:</span><span class="variable">@selector</span>(classFun)];    <span class="regexp">//</span><span class="constant">YES</span>[<span class="constant">Test</span> classFun];<span class="regexp">//</span>[<span class="constant">Test</span> objectFun];<span class="regexp">//error</span><span class="symbol">:</span> <span class="constant">Class</span> method \<span class="string">'+objectFun\' not foundTest* obj    = [[Test alloc] init];ret=[obj respondsToSelector:@selector(objectFun)];    //YESret=[obj respondsToSelector:@selector(classFun)];    //NO//[obj classFun];//error: Instance method \'-classFun\' not found[obj objectFun];return 0;}总结：1. respondsToSelector既可以检查类（是否响应指定类方法），也可以检查实例（是否响应指定实例方法）2. instancesRespondToSelector只能写在类名后面，但检测的是实例（是否响应指定实例方法）可以认为[Test instancesRespondToSelector:sel]等价于[obj respondsToSelector:sel]</span></div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/201407253/" data-id="8gqvpesxaevvlhqq" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/201407253/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014072523" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072523/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072523/">优质第三方组件收藏奋斗兄原创</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿####一、瀑布流<br><a href="http://applidium.github.io/ADLivelyCollectionView/" target="_blank" rel="external">http://applidium.github.io/ADLivelyCollectionView/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072523/" data-id="knyx9644dm28yrms" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072523/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014072517" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072517/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072517/">VLCforios230编译时光原创</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿<a href="https://wiki.videolan.org/iOSCompile" target="_blank" rel="external">https://wiki.videolan.org/iOSCompile</a> 这个是编译教程 但是由于某些下载被限制了要使用翻墙才能继续<br><a href="http://tenacy-free.com/public" target="_blank" rel="external">http://tenacy-free.com/public</a> 获取免费的翻墙账号密码(VPN)<br><a href="http://bbs.maiyadi.com/thread-879836-1-1.html" target="_blank" rel="external">http://bbs.maiyadi.com/thread-879836-1-1.html</a> mac下设置VPN操作</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072517/" data-id="0do00wccgezu8bjs" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072517/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014072510" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072510/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072510/">iOS图片拉伸解决办法Only</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿这个方法可以使图片两端不拉伸，中间拉伸。解决图片拉伸变形问题,设置之后无论把image放到什么控件中都可以自动拉伸了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UIImage *<span class="variable">image =</span> [UIImage imageNamed:@\<span class="string">"ReceiverTextNodeBkg\"</span>];</div><div class="line"><span class="variable">image =</span> [image stretchableImageWithLeftCapWidth:floorf(image.size.width/<span class="number">2</span>) topCapHeight:floorf(image.size.height/<span class="number">2</span>)];</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072510/" data-id="k9ii4rjsxn5s14hc" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072510/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014072513" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/2014072513/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/2014072513/">tableView设置可以滚动的背景图Only转载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿设置滚动背景图时，只要保证背景图在tableview中处于最低层。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//iOS7 的一句就搞定了</span></div><div class="line"> <span class="attr_selector">[tableView insertSubview:tableBackGroundView atIndex:0]</span>; </div><div class="line"> </div><div class="line"><span class="comment">//iOS6</span></div><div class="line"> <span class="attr_selector">[tableView insertSubview:tableBackGroundView atIndex:0]</span>;</div></pre></td></tr></table></figure>

<p>除此之外</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="pp">- <span class="params">(<span class="variable">UITableViewCell</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView cellForRowAtIndexPath:<span class="params">(<span class="variable">NSIndexPath</span> *)</span>indexPath；</span></div><div class="line">- <span class="params">(<span class="variable">UIView</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView viewForFooterInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;</div><div class="line">- <span class="params">(<span class="variable">UIView</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView viewForHeaderInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;</div></pre></td></tr></table></figure>

<p>上面的三个方法若被调用则要在被调用的方法加一句</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">[tableView sendSubviewToBack:tableBackGroundView]</span><span class="comment">;</span></div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/2014072513/" data-id="qy3reslt5xpieoe6" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/2014072513/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-201407258" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/27/201407258/" class="article-date">
  <time datetime="2014-07-27T10:02:03.000Z" itemprop="datePublished">Jul 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ios/">ios</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/27/201407258/">iOS开发各种库各种工具包输入兄转载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>﻿<a href="http://github.ibireme.com/github/list/ios/" target="_blank" rel="external">iOS开发各种库各种工具包输入兄转载</a><a href="http://github.ibireme.com/github/list/ios/" target="_blank" rel="external">http://github.ibireme.com/github/list/ios/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://reqianduan.com/2014/07/27/201407258/" data-id="lrxiehftylf6jqlu" class="article-share-link">Share</a>
      
        <a href="http://reqianduan.com/2014/07/27/201407258/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ios/">ios</a><span class="category-list-count">21</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a><span class="tag-list-count">21</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ios/" style="font-size: NaNpx;">ios</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07">July 2014</a><span class="archive-list-count">22</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/07/27/2014072520/">数组归类前提是已经排序好笑脸</a>
          </li>
        
          <li>
            <a href="/2014/07/27/2014072511/">objectc之runtime四川兄原创</a>
          </li>
        
          <li>
            <a href="/2014/07/27/201407259/">ios手势密码四川兄原创</a>
          </li>
        
          <li>
            <a href="/2014/07/27/201407256/">(no title)</a>
          </li>
        
          <li>
            <a href="/2014/07/27/201407253/">instancesRespondToSelector与respondsToSelector注意点Only转载</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://lwgarmstrong.github.io">lwgarmstrong</a>
          </li>
        
          <li>
            <a href="http://songbai1211.github.io">baige</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 zhang song bai<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank" rel="external nofollow">Hexo</a>
      .
      Theme by <a href="http://xiguabaobao.com/" target="_blank" rel="external nofollow">西瓜宝宝</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'reqianduan';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>